tosca_definitions_version: 'cloudify_dsl_1_2'

imports:
  - http://www.getcloudify.org/spec/cloudify/3.4m1/types.yaml

description: >
  Micro web sites hosting.

relationships:                            # New relationship type
  new_relationship_type:
    derived_from: cloudify.relationships.connected_to
    target_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure: scripts/remote_increment.sh
        postconfigure: scripts/remote_increment.sh
        establish: scripts/remote_increment.sh
  old_relationship_type:                  # Old relationship type
    derived_from: cloudify.relationships.contained_in
    source_interfaces:
      cloudify.interfaces.relationship_lifecycle:
        preconfigure: scripts/increment.sh
        postconfigure: scripts/increment.sh
        establish: scripts/increment.sh

node_templates:
  server:
    type: cloudify.nodes.Compute

  server2:
    type: cloudify.nodes.Compute

  old_site:
    type: cloudify.nodes.Compute
    relationships:
      - type: old_relationship_type
        target: server
      - type: new_relationship_type # New relationship instance
        target: server2
