definitions:

    imports:
        - "cloudify.types"
        - "cloudmock.yaml"
        - "connectionconfigurermock.yaml"
        - "testmockoperations.yaml"

    service_templates:
        simple_web_server:
            topology:
                host:
                    type: "cloudify.tosca.types.host"
                    policies:
                        start_detection_policy:
                            rules:
                                host_state:
                                    type: "state_equals"
                                    properties:
                                        service: "machine-status"
                                        state: "running"
                mock_node_that_connects_to_host:
                    type: "cloudify.tosca.types.app_module"
                    interfaces:
                        - "mock_interface"
                    relationships:
                        -   type: "cloudify.tosca.relationships.connected_to"
                            target: "host"
                            interface_implementation: "connection_configurer_mock"
                            run_phase: "pre_source_started"
                            run_location: "source"
                    policies:
                        start_detection_policy:
                            rules:
                                host_state:
                                    type: "state_equals"
                                    properties:
                                        service: "mock-node-status"
                                        state: "running"

    plans:
        simple_web_server.mock_node_that_connects_to_host:
            init:
                radial: |
                    define app_module_init
                        execute_operation operation: 'make_reachable'
