tosca_definitions_version: 'cloudify_dsl_1_2'

imports:
  - http://www.getcloudify.org/spec/cloudify/3.4m1/types.yaml

description: >
  Micro web sites hosting.

node_types:
  new_node_type:                            # New node type
    derived_from: cloudify.nodes.WebServer
    properties:
      port:
        description: port
        type: integer
        default: 8081
    interfaces:
      cloudify.interfaces.lifecycle:
        create: scripts/increment.sh        # resource already exists
        configure: scripts/increment.sh
        start: scripts/increment.sh


node_templates:
  server:
    type: cloudify.nodes.Compute

  old_site:
    type: cloudify.nodes.Compute

  new_site:                                   # New node instance
    type: new_node_type
    relationships:
      - type: cloudify.relationships.contained_in
        target: server
        source_interfaces:
          cloudify.interfaces.relationship_lifecycle:
            preconfigure: scripts/increment.sh
            establish: scripts/increment.sh
            postconfigure: scripts/increment.sh