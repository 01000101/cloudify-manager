imports:
  - "cloudify.types"
  - "cloudmock.yaml"
  - "testmockoperations.yaml"

blueprint:
  name: "multi_instance"
  topology:
    - name: "host"
      type: "cloudify.types.host"
      interfaces:
        cloudify.interfaces.lifecycle:
          - create: cloudmock.tasks.provision
          - start: cloudmock.tasks.start
      instances:
        deploy: 2
      policies:
        - name: "start_detection_policy"
          rules:
            - type: "state_equals"
              properties:
                service: "machine-status"
                state: "running"
    - name: "app_module"
      type: "cloudify.types.app_module"
      interfaces:
          mock_interface:
              - "touch": testmockoperations.tasks.touch
              - "make_reachable": testmockoperations.tasks.make_reachable
              - "make_unreachable": testmockoperations.tasks.make_unreachable
              - "set_property": testmockoperations.tasks.set_property
      relationships:
        - type: "cloudify.relationships.contained_in"
          target: "host"
      policies:
        - name: "start_detection_policy"
          rules:
            - type: "state_equals"
              properties:
                service: "mock-node-status"
                state: "running"
      workflows:
        create:
          radial: |
            define app_module_init
              execute_operation operation: 'make_reachable'
